<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>MarketX</title>

<!-- ĞÑ„Ğ¸Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Telegram WebApp SDK -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@400;600;700;900&family=Geologica:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TELEGRAM THEME INTEGRATION
   Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ñ†Ğ²ĞµÑ‚Ğ° Telegram
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --tg-bg: var(--tg-theme-bg-color, #17212b);
  --tg-sec-bg: var(--tg-theme-secondary-bg-color, #232e3c);
  --tg-text: var(--tg-theme-text-color, #f5f5f5);
  --tg-hint: var(--tg-theme-hint-color, #708499);
  --tg-link: var(--tg-theme-link-color, #5288c1);
  --tg-btn: var(--tg-theme-button-color, #5288c1);
  --tg-btn-text: var(--tg-theme-button-text-color, #ffffff);

  --accent: #3b82f6;
  --accent-glow: rgba(59,130,246,0.25);
  --accent2: #f43f5e;
  --accent3: #10b981;
  --gold: #f59e0b;
  --surface: rgba(255,255,255,0.04);
  --surface2: rgba(255,255,255,0.07);
  --border: rgba(255,255,255,0.08);
  --nav-h: 64px;
  --safe-bottom: env(safe-area-inset-bottom, 0px);
}

* {
  margin:0; padding:0; box-sizing:border-box;
  -webkit-tap-highlight-color:transparent;
  -webkit-touch-callout:none;
}

html, body {
  height:100%;
  font-family:'Geologica', sans-serif;
  background: var(--tg-bg);
  color: var(--tg-text);
  overflow:hidden;
  position:fixed;
  width:100%;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SCROLL CONTAINER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.app-scroll {
  position:fixed;
  top:0; left:0; right:0;
  bottom: calc(var(--nav-h) + var(--safe-bottom));
  overflow-y: auto;
  overflow-x: hidden;
  -webkit-overflow-scrolling: touch;
  scroll-behavior: smooth;
}
.app-scroll::-webkit-scrollbar { display:none; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• BACKGROUND â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.bg-mesh {
  position:fixed; inset:0; pointer-events:none; z-index:0;
  background:
    radial-gradient(ellipse 70% 50% at 10% 0%, rgba(59,130,246,0.12) 0%, transparent 55%),
    radial-gradient(ellipse 50% 40% at 90% 100%, rgba(244,63,94,0.08) 0%, transparent 55%);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PAGES â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.page {
  display: none;
  padding: 16px 16px calc(20px);
  position: relative; z-index: 1;
  min-height: calc(100vh - var(--nav-h) - var(--safe-bottom));
  animation: pgIn 0.22s ease;
}
.page.active { display: block; }
@keyframes pgIn {
  from { opacity:0; transform:translateY(10px); }
  to   { opacity:1; transform:translateY(0); }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TYPOGRAPHY â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.page-title {
  font-family: 'Unbounded', sans-serif;
  font-size: 22px; font-weight: 800;
  letter-spacing: -0.5px;
  margin-bottom: 4px;
}
.page-sub {
  font-size: 13px; color: var(--tg-hint);
  margin-bottom: 18px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• HEADER SECTION (HOME) â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.home-header {
  display: flex; align-items: center;
  justify-content: space-between;
  margin-bottom: 18px;
}
.greeting-wrap .greeting-label {
  font-size: 12px; color: var(--tg-hint);
}
.greeting-wrap .greeting-name {
  font-family: 'Unbounded', sans-serif;
  font-size: 18px; font-weight: 700;
}
.role-pill {
  display: inline-flex; align-items: center; gap: 5px;
  padding: 6px 14px; border-radius: 20px;
  font-size: 11px; font-weight: 700;
  letter-spacing: 0.3px;
  border: 1px solid transparent;
  cursor: pointer; transition: transform .15s;
}
.role-pill:active { transform: scale(0.94); }
.rp-owner  { background: rgba(245,158,11,0.15); color: var(--gold);   border-color: rgba(245,158,11,0.3); }
.rp-mod    { background: rgba(139,92,246,0.15);  color: #8b5cf6;      border-color: rgba(139,92,246,0.3); }
.rp-user   { background: rgba(112,132,153,0.15); color: var(--tg-hint); border-color: var(--border); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• HERO BANNER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.hero-banner {
  background: linear-gradient(135deg, #1d4ed8 0%, #3b82f6 50%, #06b6d4 100%);
  border-radius: 20px; padding: 20px;
  margin-bottom: 18px;
  position: relative; overflow: hidden;
}
.hero-banner::before {
  content: '';
  position: absolute; right: -15px; top: -25px;
  width: 110px; height: 110px;
  background: rgba(255,255,255,0.1);
  border-radius: 50%;
}
.hero-banner::after {
  content: '';
  position: absolute; right: 30px; bottom: -30px;
  width: 80px; height: 80px;
  background: rgba(255,255,255,0.06);
  border-radius: 50%;
}
.hero-tag {
  display: inline-block;
  background: rgba(255,255,255,0.2);
  border-radius: 8px; padding: 3px 10px;
  font-size: 11px; font-weight: 600;
  margin-bottom: 8px;
}
.hero-title {
  font-family: 'Unbounded', sans-serif;
  font-size: 17px; font-weight: 800;
  margin-bottom: 4px; line-height: 1.3;
}
.hero-sub { font-size: 12px; opacity: 0.85; margin-bottom: 14px; }
.hero-btn {
  display: inline-flex; align-items: center; gap: 6px;
  background: #fff; color: #1d4ed8;
  border: none; border-radius: 12px;
  padding: 9px 18px; font-size: 12px; font-weight: 700;
  font-family: 'Geologica', sans-serif;
  cursor: pointer; transition: transform .15s, box-shadow .15s;
  box-shadow: 0 4px 16px rgba(0,0,0,0.2);
}
.hero-btn:active { transform: scale(0.95); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SEARCH â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.search-wrap {
  position: relative; margin-bottom: 14px;
}
.search-ico {
  position: absolute; left: 14px; top: 50%;
  transform: translateY(-50%);
  font-size: 15px; color: var(--tg-hint);
  pointer-events: none;
}
.search-input {
  width: 100%;
  background: var(--tg-sec-bg);
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 12px 16px 12px 42px;
  color: var(--tg-text);
  font-family: 'Geologica', sans-serif;
  font-size: 14px; outline: none;
  transition: border-color .2s, background .2s;
  -webkit-appearance: none;
}
.search-input:focus {
  border-color: rgba(59,130,246,0.5);
  background: var(--surface2);
}
.search-input::placeholder { color: var(--tg-hint); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CHIPS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.chips-row {
  display: flex; gap: 8px;
  overflow-x: auto; padding-bottom: 2px;
  margin-bottom: 16px; scrollbar-width: none;
}
.chips-row::-webkit-scrollbar { display: none; }
.chip {
  flex-shrink: 0;
  padding: 7px 13px; border-radius: 20px;
  font-size: 12px; font-weight: 600;
  border: 1px solid var(--border);
  background: var(--tg-sec-bg);
  color: var(--tg-hint);
  cursor: pointer; transition: all .18s;
  white-space: nowrap; user-select: none;
}
.chip.on {
  background: var(--accent);
  border-color: var(--accent);
  color: #fff;
}
.chip:active { transform: scale(0.93); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PRODUCT GRID â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.product-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
}
.prod-card {
  background: var(--tg-sec-bg);
  border: 1px solid var(--border);
  border-radius: 18px; overflow: hidden;
  cursor: pointer; transition: transform .18s;
  position: relative;
  animation: cardIn .3s ease both;
}
.prod-card:active { transform: scale(0.96); }
@keyframes cardIn {
  from { opacity:0; transform:scale(0.94); }
  to   { opacity:1; transform:scale(1); }
}
.prod-img {
  width: 100%; height: 130px;
  background: var(--surface2);
  display: flex; align-items: center; justify-content: center;
  font-size: 52px; position: relative;
}
.prod-badge {
  position: absolute; top: 8px; right: 8px;
  padding: 2px 8px; border-radius: 6px;
  font-size: 10px; font-weight: 700;
}
.pb-hot  { background: var(--accent2); color: #fff; }
.pb-new  { background: var(--accent3); color: #fff; }
.pb-sale { background: var(--gold);    color: #000; }
.fav-ico {
  position: absolute; top: 8px; left: 8px;
  width: 30px; height: 30px; border-radius: 50%;
  background: rgba(0,0,0,0.35); backdrop-filter: blur(8px);
  border: none; display: flex; align-items: center; justify-content: center;
  font-size: 15px; cursor: pointer;
  transition: transform .18s, background .18s;
}
.fav-ico.on { background: rgba(244,63,94,0.3); }
.fav-ico:active { transform: scale(1.25); }
.prod-body { padding: 11px 12px; }
.prod-name {
  font-size: 13px; font-weight: 600;
  line-height: 1.3; margin-bottom: 6px;
}
.prod-bottom { display: flex; align-items: center; justify-content: space-between; }
.prod-price {
  font-family: 'Unbounded', sans-serif;
  font-size: 13px; font-weight: 800;
  color: var(--accent);
}
.buy-btn-mini {
  width: 28px; height: 28px; border-radius: 8px;
  background: var(--accent); border: none;
  color: #fff; font-size: 16px; line-height: 1;
  cursor: pointer; display: flex; align-items: center; justify-content: center;
  transition: transform .15s;
}
.buy-btn-mini:active { transform: scale(0.88); }
.prod-seller { font-size: 10px; color: var(--tg-hint); margin-top: 4px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SECTION LABEL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.sec-label {
  font-family: 'Unbounded', sans-serif;
  font-size: 11px; font-weight: 700;
  color: var(--tg-hint); text-transform: uppercase;
  letter-spacing: 1.2px; margin-bottom: 12px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MY LISTINGS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.add-listing-btn {
  width: 100%; border: 2px dashed rgba(59,130,246,0.4);
  background: rgba(59,130,246,0.06);
  border-radius: 16px; padding: 16px;
  display: flex; align-items: center; justify-content: center; gap: 8px;
  color: var(--accent); font-weight: 700; font-size: 14px;
  font-family: 'Geologica', sans-serif;
  cursor: pointer; margin-bottom: 16px;
  transition: all .2s;
}
.add-listing-btn:active { transform: scale(0.98); background: rgba(59,130,246,0.12); }
.listing-item {
  background: var(--tg-sec-bg);
  border: 1px solid var(--border);
  border-radius: 16px; padding: 14px;
  display: flex; gap: 12px; align-items: center;
  margin-bottom: 10px; cursor: pointer;
  transition: transform .18s;
}
.listing-item:active { transform: scale(0.98); }
.li-emoji {
  width: 54px; height: 54px; border-radius: 14px;
  background: var(--surface2);
  display: flex; align-items: center; justify-content: center;
  font-size: 28px; flex-shrink: 0;
}
.li-info { flex: 1; min-width: 0; }
.li-name { font-size: 14px; font-weight: 600; margin-bottom: 3px; }
.li-desc {
  font-size: 12px; color: var(--tg-hint);
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.li-row { display: flex; align-items: center; justify-content: space-between; margin-top: 7px; }
.li-price {
  font-family: 'Unbounded', sans-serif;
  font-size: 13px; font-weight: 800; color: var(--accent);
}
.status-chip {
  font-size: 10px; font-weight: 700;
  padding: 3px 9px; border-radius: 7px;
}
.s-active  { background: rgba(16,185,129,0.15); color: var(--accent3); }
.s-sold    { background: rgba(244,63,94,0.15);   color: var(--accent2); }
.s-pending { background: rgba(245,158,11,0.15);  color: var(--gold); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• FAVORITES â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.empty-wrap {
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  padding: 60px 20px; text-align: center;
}
.empty-emoji { font-size: 60px; margin-bottom: 14px; }
.empty-title {
  font-family: 'Unbounded', sans-serif;
  font-size: 16px; font-weight: 700; margin-bottom: 6px;
}
.empty-sub { font-size: 13px; color: var(--tg-hint); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PROFILE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.profile-hero {
  background: var(--tg-sec-bg);
  border: 1px solid var(--border);
  border-radius: 22px; padding: 22px;
  text-align: center; margin-bottom: 16px;
  position: relative; overflow: hidden;
}
.profile-hero::before {
  content: '';
  position: absolute; top: 0; left: 0; right: 0; height: 70px;
  background: linear-gradient(135deg, rgba(59,130,246,0.2), rgba(244,63,94,0.1));
}
.p-avatar-wrap { position: relative; display: inline-block; margin-bottom: 12px; }
.p-avatar {
  width: 76px; height: 76px; border-radius: 50%;
  background: linear-gradient(135deg, #3b82f6, #f43f5e);
  display: flex; align-items: center; justify-content: center;
  font-family: 'Unbounded', sans-serif;
  font-size: 26px; font-weight: 800;
  border: 3px solid var(--tg-bg);
  overflow: hidden;
  position: relative; z-index: 1;
}
.p-avatar img { width: 100%; height: 100%; object-fit: cover; }
.p-crown {
  position: absolute; top: -6px; right: -4px;
  font-size: 20px; z-index: 2;
}
.p-name {
  font-family: 'Unbounded', sans-serif;
  font-size: 17px; font-weight: 800; margin-bottom: 6px;
}
.p-role-tag {
  display: inline-flex; align-items: center; gap: 5px;
  padding: 5px 16px; border-radius: 20px;
  font-size: 12px; font-weight: 700;
  margin-bottom: 16px;
  border: 1px solid transparent;
}
.prt-owner  { background: rgba(245,158,11,0.15); color: var(--gold);  border-color: rgba(245,158,11,0.3); }
.prt-mod    { background: rgba(139,92,246,0.15);  color: #8b5cf6;     border-color: rgba(139,92,246,0.3); }
.prt-user   { background: rgba(112,132,153,0.15); color: var(--tg-hint); border-color: var(--border); }
.stats-grid {
  display: grid; grid-template-columns: repeat(3, 1fr);
  gap: 1px; background: var(--border);
  border-radius: 14px; overflow: hidden;
}
.stat-box {
  background: var(--tg-bg);
  padding: 12px 6px; text-align: center;
}
.stat-val {
  font-family: 'Unbounded', sans-serif;
  font-size: 15px; font-weight: 800; color: var(--accent);
}
.stat-key { font-size: 10px; color: var(--tg-hint); margin-top: 2px; }

.settings-group { display: flex; flex-direction: column; gap: 8px; margin-bottom: 16px; }
.settings-row {
  background: var(--tg-sec-bg);
  border: 1px solid var(--border);
  border-radius: 14px; padding: 14px 16px;
  display: flex; align-items: center; gap: 12px;
  cursor: pointer; transition: transform .15s;
}
.settings-row:active { transform: scale(0.98); }
.sr-icon { font-size: 20px; width: 32px; text-align: center; }
.sr-text { flex: 1; font-size: 14px; font-weight: 500; }
.sr-arr { color: var(--tg-hint); font-size: 18px; }
.sr-danger { color: var(--accent2); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ADMIN PANEL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.admin-hero {
  background: linear-gradient(135deg, rgba(245,158,11,0.15), rgba(59,130,246,0.1));
  border: 1px solid rgba(245,158,11,0.25);
  border-radius: 20px; padding: 18px;
  display: flex; align-items: center; gap: 14px;
  margin-bottom: 18px;
}
.admin-hero-icon { font-size: 40px; }
.admin-hero-title {
  font-family: 'Unbounded', sans-serif;
  font-size: 14px; font-weight: 800;
  color: var(--gold); margin-bottom: 3px;
}
.admin-hero-sub { font-size: 12px; color: var(--tg-hint); }
.stats-4 {
  display: grid; grid-template-columns: repeat(2, 1fr);
  gap: 10px; margin-bottom: 18px;
}
.stat-card {
  background: var(--tg-sec-bg);
  border: 1px solid var(--border);
  border-radius: 16px; padding: 16px;
  text-align: center; cursor: pointer;
  transition: transform .15s;
}
.stat-card:active { transform: scale(0.95); }
.sc-icon { font-size: 26px; margin-bottom: 6px; }
.sc-val {
  font-family: 'Unbounded', sans-serif;
  font-size: 19px; font-weight: 800; margin-bottom: 2px;
}
.sc-key { font-size: 11px; color: var(--tg-hint); }
.user-row {
  background: var(--tg-sec-bg);
  border: 1px solid var(--border);
  border-radius: 14px; padding: 12px 14px;
  display: flex; align-items: center; gap: 12px;
  margin-bottom: 8px; cursor: pointer;
  transition: transform .15s;
}
.user-row:active { transform: scale(0.98); }
.ur-av {
  width: 42px; height: 42px; border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-family: 'Unbounded', sans-serif;
  font-size: 15px; font-weight: 700; flex-shrink: 0;
}
.ur-name { font-size: 13px; font-weight: 600; }
.ur-role { font-size: 11px; margin-top: 2px; }
.ur-btns { margin-left: auto; display: flex; gap: 6px; }
.ur-btn {
  padding: 5px 10px; border-radius: 8px;
  font-size: 11px; font-weight: 700;
  border: none; cursor: pointer;
  font-family: 'Geologica', sans-serif;
  transition: transform .15s;
}
.ur-btn:active { transform: scale(0.9); }
.urb-w { background: rgba(245,158,11,0.15); color: var(--gold); }
.urb-b { background: rgba(244,63,94,0.15);  color: var(--accent2); }
.urb-m { background: rgba(139,92,246,0.15); color: #8b5cf6; }
.tg-username { font-size: 11px; color: var(--tg-hint); font-style: normal; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• BOTTOM NAV â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.bottom-nav {
  position: fixed;
  bottom: 0; left: 0; right: 0;
  height: calc(var(--nav-h) + var(--safe-bottom));
  padding-bottom: var(--safe-bottom);
  background: rgba(23,33,43,0.92);
  backdrop-filter: blur(28px) saturate(1.4);
  -webkit-backdrop-filter: blur(28px) saturate(1.4);
  border-top: 1px solid var(--border);
  display: flex; z-index: 100;
}
.nav-btn {
  flex: 1; display: flex; flex-direction: column;
  align-items: center; justify-content: center; gap: 4px;
  background: none; border: none;
  color: var(--tg-hint);
  cursor: pointer; transition: color .2s;
  padding: 0; position: relative;
}
.nav-btn.on { color: var(--accent); }
.nav-btn .n-ico {
  font-size: 23px;
  transition: transform .2s;
  display: block;
}
.nav-btn.on .n-ico { transform: scale(1.15); }
.nav-btn .n-lbl { font-size: 10px; font-weight: 600; }
.nav-badge {
  position: absolute; top: 5px;
  left: calc(50% + 4px);
  width: 8px; height: 8px; border-radius: 50%;
  background: var(--accent2);
  border: 2px solid var(--tg-bg);
}
/* Active tab indicator */
.nav-btn.on::after {
  content: '';
  position: absolute; bottom: -1px;
  width: 28px; height: 2px;
  background: var(--accent);
  border-radius: 2px 2px 0 0;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.modal-bg {
  position: fixed; inset: 0; z-index: 200;
  background: rgba(0,0,0,0.65);
  backdrop-filter: blur(4px);
  display: none; align-items: flex-end;
}
.modal-bg.open { display: flex; }
.modal-sheet {
  width: 100%; max-height: 90vh;
  background: var(--tg-sec-bg);
  border-radius: 22px 22px 0 0;
  overflow-y: auto; padding: 0 18px 32px;
  animation: sheetUp .28s cubic-bezier(.32,1.2,.64,1);
}
.modal-sheet::-webkit-scrollbar { display: none; }
@keyframes sheetUp {
  from { transform: translateY(100%); }
  to   { transform: translateY(0); }
}
.modal-handle {
  width: 38px; height: 4px; border-radius: 2px;
  background: var(--border); margin: 14px auto 18px;
}
.modal-title {
  font-family: 'Unbounded', sans-serif;
  font-size: 18px; font-weight: 800; margin-bottom: 18px;
}
.form-block { margin-bottom: 14px; }
.form-lbl {
  font-size: 11px; font-weight: 700;
  color: var(--tg-hint); text-transform: uppercase;
  letter-spacing: 0.8px; margin-bottom: 7px; display: block;
}
.form-ctrl {
  width: 100%;
  background: var(--tg-bg);
  border: 1px solid var(--border);
  border-radius: 13px;
  padding: 13px 15px;
  color: var(--tg-text);
  font-family: 'Geologica', sans-serif;
  font-size: 14px; outline: none;
  transition: border-color .2s;
  -webkit-appearance: none; appearance: none;
}
.form-ctrl:focus { border-color: rgba(59,130,246,0.5); }
.form-ctrl::placeholder { color: var(--tg-hint); }
textarea.form-ctrl { resize: none; min-height: 80px; }
.emoji-grid {
  display: grid; grid-template-columns: repeat(6, 1fr);
  gap: 8px;
}
.ej-opt {
  aspect-ratio: 1; border-radius: 11px;
  background: var(--tg-bg);
  border: 2px solid transparent;
  display: flex; align-items: center; justify-content: center;
  font-size: 26px; cursor: pointer;
  transition: border-color .15s, transform .15s;
}
.ej-opt.sel { border-color: var(--accent); }
.ej-opt:active { transform: scale(0.88); }
.submit-btn {
  width: 100%;
  background: linear-gradient(135deg, #2563eb, #3b82f6);
  border: none; border-radius: 15px; padding: 16px;
  color: #fff; font-family: 'Geologica', sans-serif;
  font-size: 15px; font-weight: 700;
  cursor: pointer; margin-top: 8px;
  transition: transform .15s, box-shadow .15s;
  box-shadow: 0 4px 20px rgba(59,130,246,0.35);
}
.submit-btn:active { transform: scale(0.97); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PRODUCT DETAIL MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.pd-img { font-size: 80px; text-align: center; padding: 20px; background: var(--surface); border-radius: 16px; margin-bottom: 16px; }
.pd-name { font-family: 'Unbounded', sans-serif; font-size: 18px; font-weight: 800; margin-bottom: 4px; }
.pd-price { font-family: 'Unbounded', sans-serif; font-size: 22px; font-weight: 900; color: var(--accent); margin-bottom: 6px; }
.pd-seller { font-size: 12px; color: var(--tg-hint); margin-bottom: 14px; }
.pd-desc { font-size: 14px; color: var(--tg-hint); line-height: 1.6; margin-bottom: 20px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TOAST â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.toast {
  position: fixed; top: 16px; left: 16px; right: 16px;
  z-index: 300;
  background: var(--tg-sec-bg);
  border: 1px solid var(--border);
  border-radius: 14px; padding: 13px 16px;
  display: flex; align-items: center; gap: 10px;
  transform: translateY(calc(-100% - 30px));
  transition: transform .3s cubic-bezier(.34,1.56,.64,1);
  box-shadow: 0 8px 40px rgba(0,0,0,0.4);
}
.toast.show { transform: translateY(0); }
.t-ico { font-size: 20px; }
.t-txt { font-size: 13px; font-weight: 500; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• UTILS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.gap-row { display: flex; gap: 8px; }
.flex-between { display: flex; align-items: center; justify-content: space-between; margin-bottom: 14px; }
.view-all { font-size: 12px; color: var(--accent); font-weight: 600; cursor: pointer; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TELEGRAM HAPTIC PULSE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@keyframes hapticPulse {
  0%,100% { transform: scale(1); }
  50% { transform: scale(0.94); }
}
</style>
</head>
<body>
<div class="bg-mesh"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â• TOAST â•â•â•â•â•â•â•â•â•â•â• -->
<div class="toast" id="toast">
  <span class="t-ico" id="t-ico">âœ…</span>
  <span class="t-txt" id="t-txt">Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾</span>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• SCROLL WRAPPER â•â•â•â•â•â•â•â•â•â•â• -->
<div class="app-scroll" id="appScroll">

  <!-- â•â•â•â•â•â• PAGE: HOME â•â•â•â•â•â• -->
  <div class="page active" id="pg-home">
    <div class="home-header">
      <div class="greeting-wrap">
        <div class="greeting-label">Ğ”Ğ¾Ğ±Ñ€Ğ¾ Ğ¿Ğ¾Ğ¶Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚ÑŒ,</div>
        <div class="greeting-name" id="tg-name">ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ</div>
      </div>
      <div class="role-pill rp-owner" id="rolePill" onclick="goPage('admin')">ğŸ‘‘ Ğ’Ğ»Ğ°Ğ´ĞµĞ»ĞµÑ†</div>
    </div>

    <div class="hero-banner">
      <div class="hero-tag">ğŸ”¥ ĞĞºÑ†Ğ¸Ñ Ğ´Ğ½Ñ</div>
      <div class="hero-title">Ğ¡ĞºĞ¸Ğ´ĞºĞ¸ Ğ´Ğ¾ 60%<br>Ğ½Ğ° Ñ‚Ğ¾Ğ¿ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñ‹</div>
      <div class="hero-sub">Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ â€” Ğ»ÑƒÑ‡ÑˆĞ¸Ğµ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ</div>
      <button class="hero-btn" onclick="haptic('light');filterChip('all')">Ğ¡Ğ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ â†’</button>
    </div>

    <div class="search-wrap">
      <span class="search-ico">ğŸ”</span>
      <input class="search-input" id="searchInp" placeholder="ĞŸĞ¾Ğ¸ÑĞº Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ²..." oninput="searchProducts(this.value)">
    </div>

    <div class="chips-row" id="chipsRow">
      <div class="chip on" data-cat="all" onclick="filterChip('all')">Ğ’ÑĞµ</div>
      <div class="chip" data-cat="electronics" onclick="filterChip('electronics')">ğŸ“± Ğ­Ğ»ĞµĞºÑ‚Ñ€Ğ¾Ğ½Ğ¸ĞºĞ°</div>
      <div class="chip" data-cat="clothes"     onclick="filterChip('clothes')">ğŸ‘— ĞĞ´ĞµĞ¶Ğ´Ğ°</div>
      <div class="chip" data-cat="games"       onclick="filterChip('games')">ğŸ® Ğ˜Ğ³Ñ€Ñ‹</div>
      <div class="chip" data-cat="home"        onclick="filterChip('home')">ğŸ  Ğ”Ğ¾Ğ¼</div>
      <div class="chip" data-cat="sport"       onclick="filterChip('sport')">âš½ Ğ¡Ğ¿Ğ¾Ñ€Ñ‚</div>
      <div class="chip" data-cat="beauty"      onclick="filterChip('beauty')">ğŸ’„ ĞšÑ€Ğ°ÑĞ¾Ñ‚Ğ°</div>
    </div>

    <div class="flex-between">
      <div class="sec-label">ĞšĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ²</div>
      <div class="view-all" onclick="haptic('light')">Ğ’ÑĞµ â†’</div>
    </div>
    <div class="product-grid" id="productGrid"></div>
  </div>

  <!-- â•â•â•â•â•â• PAGE: LISTINGS â•â•â•â•â•â• -->
  <div class="page" id="pg-listings">
    <div class="page-title">ĞœĞ¾Ğ¸ Ğ¾Ğ±ÑŠÑĞ²Ğ»ĞµĞ½Ğ¸Ñ</div>
    <div class="page-sub">Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞ¹Ñ‚Ğµ ÑĞ²Ğ¾Ğ¸Ğ¼Ğ¸ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°Ğ¼Ğ¸</div>
    <button class="add-listing-btn" onclick="openAddModal()">ï¼‹ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¾Ğ±ÑŠÑĞ²Ğ»ĞµĞ½Ğ¸Ğµ</button>
    <div id="myListingsWrap"></div>
  </div>

  <!-- â•â•â•â•â•â• PAGE: FAVORITES â•â•â•â•â•â• -->
  <div class="page" id="pg-fav">
    <div class="page-title">Ğ˜Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ</div>
    <div class="page-sub">Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ñ‘Ğ½Ğ½Ñ‹Ğµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñ‹</div>
    <div class="product-grid" id="favGrid"></div>
    <div class="empty-wrap" id="favEmpty" style="display:none">
      <div class="empty-emoji">ğŸ’«</div>
      <div class="empty-title">Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ¿ÑƒÑÑ‚</div>
      <div class="empty-sub">ĞĞ°Ğ¶Ğ¸Ğ¼Ğ°Ğ¹ â™¡ Ğ½Ğ° Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°Ñ…, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ</div>
    </div>
  </div>

  <!-- â•â•â•â•â•â• PAGE: ADMIN â•â•â•â•â•â• -->
  <div class="page" id="pg-admin">
    <div class="admin-hero">
      <div class="admin-hero-icon">ğŸ‘‘</div>
      <div>
        <div class="admin-hero-title">ĞŸĞ°Ğ½ĞµĞ»ÑŒ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ</div>
        <div class="admin-hero-sub">ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğº Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğµ MarketX</div>
      </div>
    </div>

    <div class="stats-4">
      <div class="stat-card" onclick="haptic('medium');toast('ğŸ‘¥','ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ñ‹')">
        <div class="sc-icon">ğŸ‘¥</div>
        <div class="sc-val">1,247</div>
        <div class="sc-key">ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹</div>
      </div>
      <div class="stat-card" onclick="haptic('medium');toast('ğŸ“¦','ĞĞ±ÑŠÑĞ²Ğ»ĞµĞ½Ğ¸Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ñ‹')">
        <div class="sc-icon">ğŸ“¦</div>
        <div class="sc-val">3,891</div>
        <div class="sc-key">ĞĞ±ÑŠÑĞ²Ğ»ĞµĞ½Ğ¸Ğ¹</div>
      </div>
      <div class="stat-card" onclick="haptic('medium');toast('ğŸ’°','â‚½842K Ğ¾Ğ±Ğ¾Ñ€Ğ¾Ñ‚')">
        <div class="sc-icon">ğŸ’°</div>
        <div class="sc-val">â‚½842K</div>
        <div class="sc-key">ĞĞ±Ğ¾Ñ€Ğ¾Ñ‚</div>
      </div>
      <div class="stat-card" onclick="haptic('medium');toast('ğŸ“Š','ĞÑ‚Ñ‡Ñ‘Ñ‚ Ğ³Ğ¾Ñ‚Ğ¾Ğ²')">
        <div class="sc-icon">ğŸ“Š</div>
        <div class="sc-val">94%</div>
        <div class="sc-key">Ğ”Ğ¾Ğ²Ğ¾Ğ»ÑŒĞ½Ñ‹Ñ…</div>
      </div>
    </div>

    <div id="adminRoleSection">
      <div class="flex-between">
        <div class="sec-label">ĞŸÑ€Ğ°Ğ²Ğ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° (Ğ´ĞµĞ¼Ğ¾)</div>
      </div>
      <div class="chips-row" id="roleChips">
        <div class="chip" data-role="user"      onclick="setRole('user',this)">ğŸ‘¤ ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ</div>
        <div class="chip" data-role="moderator" onclick="setRole('moderator',this)">ğŸ›¡ï¸ ĞœĞ¾Ğ´ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€</div>
        <div class="chip on" data-role="owner"  onclick="setRole('owner',this)">ğŸ‘‘ Ğ’Ğ»Ğ°Ğ´ĞµĞ»ĞµÑ†</div>
      </div>
    </div>

    <div class="flex-between" style="margin-top:8px">
      <div class="sec-label">ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸</div>
      <div class="view-all">Ğ’ÑĞµ â†’</div>
    </div>
    <div id="adminUserList"></div>
  </div>

  <!-- â•â•â•â•â•â• PAGE: PROFILE â•â•â•â•â•â• -->
  <div class="page" id="pg-profile">
    <div class="profile-hero">
      <div class="p-avatar-wrap">
        <div class="p-avatar" id="pAvatar">Ğ</div>
        <div class="p-crown" id="pCrown">ğŸ‘‘</div>
      </div>
      <div class="p-name" id="pName">ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ</div>
      <div class="p-role-tag prt-owner" id="pRoleTag">ğŸ‘‘ Ğ’Ğ»Ğ°Ğ´ĞµĞ»ĞµÑ†</div>
      <div class="stats-grid">
        <div class="stat-box"><div class="stat-val">24</div><div class="stat-key">ĞŸÑ€Ğ¾Ğ´Ğ°Ğ¶</div></div>
        <div class="stat-box"><div class="stat-val">â‚½48K</div><div class="stat-key">Ğ—Ğ°Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ½Ğ¾</div></div>
        <div class="stat-box"><div class="stat-val">4.9â­</div><div class="stat-key">Ğ ĞµĞ¹Ñ‚Ğ¸Ğ½Ğ³</div></div>
      </div>
    </div>

    <div class="settings-group">
      <div class="settings-row" onclick="haptic('light');toast('âœï¸','Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ')">
        <span class="sr-icon">âœï¸</span><span class="sr-text">Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ</span><span class="sr-arr">â€º</span>
      </div>
      <div class="settings-row" onclick="haptic('light');toast('ğŸ””','ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹')">
        <span class="sr-icon">ğŸ””</span><span class="sr-text">Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ</span><span class="sr-arr">â€º</span>
      </div>
      <div class="settings-row" onclick="haptic('light');toast('ğŸ’³','ĞŸĞ»Ğ°Ñ‚Ñ‘Ğ¶Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ')">
        <span class="sr-icon">ğŸ’³</span><span class="sr-text">ĞŸĞ»Ğ°Ñ‚Ñ‘Ğ¶Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ</span><span class="sr-arr">â€º</span>
      </div>
      <div class="settings-row" onclick="haptic('light');toast('ğŸ”’','Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ')">
        <span class="sr-icon">ğŸ”’</span><span class="sr-text">Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ Ğ¸ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ</span><span class="sr-arr">â€º</span>
      </div>
      <div class="settings-row" onclick="haptic('light');toast('ğŸ“','ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ°')">
        <span class="sr-icon">ğŸ“</span><span class="sr-text">Ğ¢ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ°</span><span class="sr-arr">â€º</span>
      </div>
      <div class="settings-row" onclick="haptic('medium');toast('ğŸ‘‹','Ğ”Ğ¾ ÑĞ²Ğ¸Ğ´Ğ°Ğ½Ğ¸Ñ!')">
        <span class="sr-icon">ğŸšª</span><span class="sr-text sr-danger">Ğ’Ñ‹Ğ¹Ñ‚Ğ¸ Ğ¸Ğ· Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğ°</span><span class="sr-arr">â€º</span>
      </div>
    </div>

    <div class="tg-username" id="tgUsernameDisplay" style="text-align:center;padding:8px">
      @username Â· MarketX v1.0.0
    </div>
  </div>

</div><!-- /app-scroll -->

<!-- â•â•â•â•â•â•â•â•â•â•â• BOTTOM NAV â•â•â•â•â•â•â•â•â•â•â• -->
<nav class="bottom-nav">
  <button class="nav-btn on" id="nb-home" onclick="goPage('home')">
    <span class="n-ico">ğŸª</span>
    <span class="n-lbl">ĞœĞ°Ğ³Ğ°Ğ·Ğ¸Ğ½</span>
  </button>
  <button class="nav-btn" id="nb-listings" onclick="goPage('listings')" style="position:relative">
    <span class="n-ico">ğŸ“</span>
    <span class="n-lbl">ĞĞ±ÑŠÑĞ²Ğ»ĞµĞ½Ğ¸Ñ</span>
    <span class="nav-badge"></span>
  </button>
  <button class="nav-btn" id="nb-fav" onclick="goPage('fav')">
    <span class="n-ico">â™¡</span>
    <span class="n-lbl">Ğ˜Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ</span>
  </button>
  <button class="nav-btn" id="nb-admin" onclick="goPage('admin')">
    <span class="n-ico">âš™ï¸</span>
    <span class="n-lbl">Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ</span>
  </button>
  <button class="nav-btn" id="nb-profile" onclick="goPage('profile')">
    <span class="n-ico">ğŸ‘¤</span>
    <span class="n-lbl">ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ</span>
  </button>
</nav>

<!-- â•â•â•â•â•â•â•â•â•â•â• ADD LISTING MODAL â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-bg" id="addModal" onclick="closeAddModal(event)">
  <div class="modal-sheet">
    <div class="modal-handle"></div>
    <div class="modal-title">â• ĞĞ¾Ğ²Ğ¾Ğµ Ğ¾Ğ±ÑŠÑĞ²Ğ»ĞµĞ½Ğ¸Ğµ</div>

    <div class="form-block">
      <span class="form-lbl">Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸ Ğ¸ĞºĞ¾Ğ½ĞºÑƒ</span>
      <div class="emoji-grid" id="emojiGrid">
        ğŸ“±ğŸ’»ğŸ‘ŸğŸ®ğŸ“¸ğŸ§ğŸ‘—âŒšğŸ§´ğŸ‹ï¸ğŸ›‹ï¸ğŸ¨ğŸš—ğŸ¸ğŸ“šğŸ§¸ğŸ€ğŸ›’ğŸ”§ğŸ’¡
      </div>
    </div>
    <div class="form-block">
      <span class="form-lbl">ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ</span>
      <input class="form-ctrl" id="newName" placeholder="ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°">
    </div>
    <div class="form-block">
      <span class="form-lbl">ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ</span>
      <textarea class="form-ctrl" id="newDesc" placeholder="ĞĞ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ¸ Ğ¾ÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸..."></textarea>
    </div>
    <div class="form-block">
      <span class="form-lbl">Ğ¦ĞµĞ½Ğ° (â‚½)</span>
      <input class="form-ctrl" id="newPrice" type="number" inputmode="numeric" placeholder="0">
    </div>
    <div class="form-block">
      <span class="form-lbl">ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ</span>
      <select class="form-ctrl" id="newCat">
        <option value="electronics">ğŸ“± Ğ­Ğ»ĞµĞºÑ‚Ñ€Ğ¾Ğ½Ğ¸ĞºĞ°</option>
        <option value="clothes">ğŸ‘— ĞĞ´ĞµĞ¶Ğ´Ğ°</option>
        <option value="games">ğŸ® Ğ˜Ğ³Ñ€Ñ‹</option>
        <option value="home">ğŸ  Ğ”Ğ¾Ğ¼</option>
        <option value="sport">âš½ Ğ¡Ğ¿Ğ¾Ñ€Ñ‚</option>
        <option value="beauty">ğŸ’„ ĞšÑ€Ğ°ÑĞ¾Ñ‚Ğ°</option>
      </select>
    </div>
    <button class="submit-btn" onclick="submitListing()">ĞĞ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¾Ğ±ÑŠÑĞ²Ğ»ĞµĞ½Ğ¸Ğµ</button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• PRODUCT DETAIL MODAL â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-bg" id="pdModal" onclick="closePdModal(event)">
  <div class="modal-sheet">
    <div class="modal-handle"></div>
    <div class="pd-img" id="pd-img">ğŸ“±</div>
    <div class="pd-name" id="pd-name">ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ</div>
    <div class="pd-price" id="pd-price">â‚½0</div>
    <div class="pd-seller" id="pd-seller">@seller</div>
    <div class="pd-desc" id="pd-desc">ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ</div>
    <button class="submit-btn" onclick="haptic('medium');toast('ğŸ›’','Ğ¢Ğ¾Ğ²Ğ°Ñ€ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½ Ğ² ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ñƒ!');closePdModal({target:document.getElementById('pdModal')})">
      ĞšÑƒĞ¿Ğ¸Ñ‚ÑŒ / ĞĞ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ²Ñ†Ñƒ
    </button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     JAVASCRIPT â€” TELEGRAM WEBAPP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
/* â”€â”€â”€ Telegram WebApp Init â”€â”€â”€ */
const tg = window.Telegram?.WebApp;

if (tg) {
  tg.ready();
  tg.expand();                          // Ğ Ğ°ÑĞºÑ€Ñ‹Ñ‚ÑŒ Ğ½Ğ° Ğ²ĞµÑÑŒ ÑĞºÑ€Ğ°Ğ½
  tg.enableClosingConfirmation();       // Ğ¡Ğ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°Ñ‚ÑŒ Ğ¿ĞµÑ€ĞµĞ´ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ğ¸ĞµĞ¼
  tg.setHeaderColor('#17212b');
  tg.setBackgroundColor('#17212b');
}

/* â”€â”€â”€ Haptic Feedback (Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ğ¢Ğ“) â”€â”€â”€ */
function haptic(type = 'light') {
  tg?.HapticFeedback?.impactOccurred(type);
}
function hapticNotify(type = 'success') {
  tg?.HapticFeedback?.notificationOccurred(type);
}

/* â”€â”€â”€ User Data Ğ¸Ğ· Telegram â”€â”€â”€ */
const tgUser = tg?.initDataUnsafe?.user;
const userName   = tgUser?.first_name  ?? 'ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ';
const userHandle = tgUser?.username    ?? 'username';
const userPhoto  = tgUser?.photo_url   ?? null;
const userId     = tgUser?.id          ?? 0;

/* â”€â”€â”€ Ğ Ğ¾Ğ»Ğ¸ (Ğ² Ğ¿Ñ€Ğ¾Ğ´Ğ°ĞºÑˆĞµĞ½Ğµ Ğ±ĞµÑ€ÑƒÑ‚ÑÑ Ñ ÑĞµÑ€Ğ²ĞµÑ€Ğ° Ğ¿Ğ¾ userId) â”€â”€â”€ */
const ROLES = { owner: 'owner', moderator: 'moderator', user: 'user' };
let currentRole = 'owner'; // Default demo = owner

/* â”€â”€â”€ Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ â”€â”€â”€ */
const PRODUCTS = [
  {id:1, e:'ğŸ“±', name:'iPhone 14 Pro 256GB',    price:89900, cat:'electronics', seller:'@tech_store',   badge:'hot',  desc:'ĞšĞ¾ÑĞ¼Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ñ‡Ñ‘Ñ€Ğ½Ñ‹Ğ¹, Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ¼Ğ¿Ğ»ĞµĞºÑ‚, Ğ³Ğ°Ñ€Ğ°Ğ½Ñ‚Ğ¸Ñ 6 Ğ¼ĞµÑ.'},
  {id:2, e:'ğŸ‘Ÿ', name:'Nike Air Max 95 OG',      price:12500, cat:'clothes',     seller:'@sneaker_ru',   badge:'new',  desc:'Ğ Ğ°Ğ·Ğ¼ĞµÑ€ 42, ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ 9/10, Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ».'},
  {id:3, e:'ğŸ®', name:'DualSense PS5 White',     price:7200,  cat:'games',       seller:'@games_shop',   badge:'',     desc:'ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ² ÑƒĞ¿Ğ°ĞºĞ¾Ğ²ĞºĞµ, Ğ½Ğµ Ğ²ÑĞºÑ€Ñ‹Ğ²Ğ°Ğ»ÑÑ.'},
  {id:4, e:'ğŸ§', name:'AirPods Pro 2 MagSafe',   price:24990, cat:'electronics', seller:'@apple_fan',    badge:'hot',  desc:'ĞšÑƒĞ¿Ğ»ĞµĞ½Ñ‹ 3 Ğ¼ĞµÑÑÑ†Ğ° Ğ½Ğ°Ğ·Ğ°Ğ´, Ñ‡ĞµÑ…Ğ¾Ğ» Ğ² ĞºĞ¾Ğ¼Ğ¿Ğ»ĞµĞºÑ‚Ğµ.'},
  {id:5, e:'âŒš', name:'Apple Watch Series 9',    price:32900, cat:'electronics', seller:'@apple_fan',    badge:'',     desc:'45mm, Midnight, Ğ½Ğ¾Ğ²Ñ‹Ğ¹, Ğ½Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½.'},
  {id:6, e:'ğŸ‘—', name:'ĞŸÑƒÑ…Ğ¾Ğ²Ğ¸Ğº Canada Goose',    price:48750, cat:'clothes',     seller:'@fashion_msk',  badge:'new',  desc:'Ğ Ğ°Ğ·Ğ¼ĞµÑ€ M, Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ», Ğ¿Ğ¾ĞºÑƒĞ¿Ğ°Ğ»Ğ¸ Ğ² Ğ¾Ñ„Ğ¸Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ¼Ğ°Ğ³Ğ°Ğ·Ğ¸Ğ½Ğµ.'},
  {id:7, e:'ğŸ›‹ï¸', name:'ĞšÑ€ĞµÑĞ»Ğ¾ Herman Miller',   price:89400, cat:'home',        seller:'@mebel_pro',    badge:'sale', desc:'ĞŸĞ¾Ñ‡Ñ‚Ğ¸ Ğ½Ğ¾Ğ²Ğ¾Ğµ, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ»Ğ¾ÑÑŒ 2 Ğ¼ĞµÑÑÑ†Ğ°.'},
  {id:8, e:'ğŸ‹ï¸', name:'Ğ¨Ñ‚Ğ°Ğ½Ğ³Ğ° Ğ¾Ğ»Ğ¸Ğ¼Ğ¿Ğ¸Ğ¹ÑĞºĞ°Ñ 20ĞºĞ³',price:15600, cat:'sport',       seller:'@sportlife_ru', badge:'sale', desc:'ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ¼Ğ¿Ğ»ĞµĞºÑ‚ Ğ´Ğ¸ÑĞºĞ¾Ğ², Ğ³Ñ€Ğ¸Ñ„ 2.2Ğ¼.'},
  {id:9, e:'ğŸ’„', name:'ĞŸĞ°Ğ»ĞµÑ‚ĞºĞ° MAC 24 Ñ‚ĞµĞ½Ğ¸',     price:5800,  cat:'beauty',      seller:'@beauty_box',   badge:'',     desc:'ĞÑ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ», Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ° 2 Ñ€Ğ°Ğ·Ğ°.'},
  {id:10,e:'ğŸ“¸', name:'Sony ZV-E10 + Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ¸Ğ²',  price:54000, cat:'electronics', seller:'@photo_shop',   badge:'',     desc:'Kit 16-50mm, Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ¼Ğ¿Ğ»ĞµĞºÑ‚, Ğ¿Ñ€Ğ¾Ğ±ĞµĞ³ 2k ĞºĞ°Ğ´Ñ€Ğ¾Ğ².'},
];

const MY_LISTINGS = [
  {id:1, e:'ğŸ’»', name:'MacBook Air M2',            desc:'8/256GB, Silver, Ğ¸Ğ´ĞµĞ°Ğ»',            price:85000, status:'active'},
  {id:2, e:'ğŸ“¸', name:'Canon EOS M50 Mark II',     desc:'Kit 15-45mm, Ğ¿Ñ€Ğ¾Ğ±ĞµĞ³ 5k ĞºĞ°Ğ´Ñ€Ğ¾Ğ²',     price:32000, status:'sold'},
  {id:3, e:'ğŸ§', name:'Sony WH-1000XM5',           desc:'NC Ğ±ĞµÑĞ¿Ñ€Ğ¾Ğ²Ğ¾Ğ´Ğ½Ñ‹Ğµ, ĞµÑÑ‚ÑŒ Ñ‡ĞµÑ…Ğ¾Ğ»',       price:22500, status:'pending'},
];

const ADMIN_USERS = [
  {init:'Ğœ', name:'ĞœĞ°Ñ€Ğ¸Ñ Ğ¡Ğ¼Ğ¸Ñ€Ğ½Ğ¾Ğ²Ğ°',   tg:'@masha_s',   role:'moderator', color:'#8b5cf6'},
  {init:'Ğ”', name:'Ğ”Ğ¼Ğ¸Ñ‚Ñ€Ğ¸Ğ¹ ĞšÑƒĞ·Ğ½ĞµÑ†Ğ¾Ğ²', tg:'@dima_k',    role:'user',      color:'#10b981'},
  {init:'Ğ•', name:'Ğ•Ğ»ĞµĞ½Ğ° ĞŸĞ¾Ğ¿Ğ¾Ğ²Ğ°',     tg:'@elena_p',   role:'moderator', color:'#f59e0b'},
  {init:'Ğ˜', name:'Ğ˜Ğ²Ğ°Ğ½ Ğ¡Ğ¾ĞºĞ¾Ğ»Ğ¾Ğ²',     tg:'@ivan_sokol', role:'user',     color:'#3b82f6'},
  {init:'Ğ', name:'ĞĞ»ÑŒĞ³Ğ° ĞĞ¾Ğ²Ğ¸ĞºĞ¾Ğ²Ğ°',   tg:'@olga_n',    role:'user',      color:'#f43f5e'},
];

let favorites = new Set();
let selectedEmoji = 'ğŸ“±';
let activeCat = 'all';

/* â”€â”€â”€ INIT â”€â”€â”€ */
function init() {
  // ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ÑĞµĞ¼ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ¸Ğ· Telegram
  document.getElementById('tg-name').textContent = userName;
  document.getElementById('pName').textContent = userName + ' ' + (tgUser?.last_name ?? '');
  document.getElementById('tgUsernameDisplay').textContent = `@${userHandle} Â· MarketX v1.0.0`;

  const initials = userName.charAt(0).toUpperCase();
  document.getElementById('pAvatar').textContent = initials;

  if (userPhoto) {
    const img = document.createElement('img');
    img.src = userPhoto;
    document.getElementById('pAvatar').innerHTML = '';
    document.getElementById('pAvatar').appendChild(img);
  }

  buildEmojiGrid();
  renderProducts(PRODUCTS);
  renderMyListings();
  renderAdminUsers();
  updateRoleUI();
}

/* â”€â”€â”€ NAVIGATION â”€â”€â”€ */
const PAGES = ['home','listings','fav','admin','profile'];
function goPage(id) {
  haptic('light');
  PAGES.forEach(p => {
    document.getElementById('pg-'+p).classList.toggle('active', p===id);
    document.getElementById('nb-'+p).classList.toggle('on', p===id);
  });
  document.getElementById('appScroll').scrollTo(0,0);

  if (id === 'fav')     renderFavPage();
  if (id === 'profile') updateProfileUI();

  // Telegram MainButton
  if (id === 'listings') {
    tg?.MainButton?.setText('â• Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¾Ğ±ÑŠÑĞ²Ğ»ĞµĞ½Ğ¸Ğµ');
    tg?.MainButton?.onClick(openAddModal);
    tg?.MainButton?.show();
  } else {
    tg?.MainButton?.hide();
  }
}

/* â”€â”€â”€ PRODUCTS â”€â”€â”€ */
function renderProducts(list) {
  const g = document.getElementById('productGrid');
  if (!list.length) {
    g.innerHTML = `<div style="grid-column:1/-1;text-align:center;color:var(--tg-hint);padding:40px 0;font-size:14px">ĞĞ¸Ñ‡ĞµĞ³Ğ¾ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾ ğŸ˜”</div>`;
    return;
  }
  g.innerHTML = list.map((p,i) => `
    <div class="prod-card" style="animation-delay:${i*0.04}s" onclick="openProduct(${p.id})">
      <div class="prod-img">
        ${p.e}
        ${p.badge ? `<div class="prod-badge pb-${p.badge}">${p.badge==='hot'?'ğŸ”¥ Ğ¥Ğ¸Ñ‚':p.badge==='new'?'âœ¨ ĞĞ¾Ğ²Ñ‹Ğ¹':'ğŸ’¥ Ğ¡ĞºĞ¸Ğ´ĞºĞ°'}</div>` : ''}
        <button class="fav-ico ${favorites.has(p.id)?'on':''}" id="fico${p.id}"
          onclick="event.stopPropagation();toggleFav(${p.id})">
          ${favorites.has(p.id)?'â¤ï¸':'ğŸ¤'}
        </button>
      </div>
      <div class="prod-body">
        <div class="prod-name">${p.name}</div>
        <div class="prod-bottom">
          <div class="prod-price">â‚½${p.price.toLocaleString()}</div>
          <button class="buy-btn-mini" onclick="event.stopPropagation();haptic('medium');toast('ğŸ›’','Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ Ğ² ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ñƒ')">+</button>
        </div>
        <div class="prod-seller">${p.seller}</div>
      </div>
    </div>
  `).join('');
}

function searchProducts(q) {
  const filtered = PRODUCTS.filter(p =>
    p.name.toLowerCase().includes(q.toLowerCase()) &&
    (activeCat==='all' || p.cat===activeCat)
  );
  renderProducts(filtered);
}

function filterChip(cat) {
  activeCat = cat;
  document.querySelectorAll('#chipsRow .chip').forEach(c => {
    c.classList.toggle('on', c.dataset.cat===cat);
  });
  document.getElementById('searchInp').value = '';
  renderProducts(cat==='all' ? PRODUCTS : PRODUCTS.filter(p=>p.cat===cat));
  haptic('light');
}

function openProduct(id) {
  haptic('light');
  const p = PRODUCTS.find(x=>x.id===id);
  if (!p) return;
  document.getElementById('pd-img').textContent    = p.e;
  document.getElementById('pd-name').textContent   = p.name;
  document.getElementById('pd-price').textContent  = `â‚½${p.price.toLocaleString()}`;
  document.getElementById('pd-seller').textContent = p.seller;
  document.getElementById('pd-desc').textContent   = p.desc;
  document.getElementById('pdModal').classList.add('open');
}
function closePdModal(e) {
  if(e.target===document.getElementById('pdModal'))
    document.getElementById('pdModal').classList.remove('open');
}

/* â”€â”€â”€ FAVORITES â”€â”€â”€ */
function toggleFav(id) {
  haptic('medium');
  if (favorites.has(id)) {
    favorites.delete(id);
    hapticNotify('warning');
    toast('ğŸ’”','Ğ£Ğ±Ñ€Ğ°Ğ½Ğ¾ Ğ¸Ğ· Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾');
  } else {
    favorites.add(id);
    hapticNotify('success');
    toast('â¤ï¸','Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ Ğ² Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ');
  }
  const btn = document.getElementById('fico'+id);
  if (btn) { btn.classList.toggle('on', favorites.has(id)); btn.textContent = favorites.has(id)?'â¤ï¸':'ğŸ¤'; }
}

function renderFavPage() {
  const favList = PRODUCTS.filter(p=>favorites.has(p.id));
  const grid  = document.getElementById('favGrid');
  const empty = document.getElementById('favEmpty');
  if (!favList.length) { grid.innerHTML=''; empty.style.display='flex'; return; }
  empty.style.display = 'none';
  grid.innerHTML = favList.map(p => `
    <div class="prod-card" onclick="openProduct(${p.id})">
      <div class="prod-img">
        ${p.e}
        <button class="fav-ico on" onclick="event.stopPropagation();toggleFav(${p.id});renderFavPage()">â¤ï¸</button>
      </div>
      <div class="prod-body">
        <div class="prod-name">${p.name}</div>
        <div class="prod-bottom">
          <div class="prod-price">â‚½${p.price.toLocaleString()}</div>
        </div>
        <div class="prod-seller">${p.seller}</div>
      </div>
    </div>
  `).join('');
}

/* â”€â”€â”€ MY LISTINGS â”€â”€â”€ */
function renderMyListings() {
  const wrap = document.getElementById('myListingsWrap');
  wrap.innerHTML = MY_LISTINGS.map(l => `
    <div class="listing-item" onclick="haptic('light');toast('ğŸ“„','${l.name.replace(/'/g,'')}')">
      <div class="li-emoji">${l.e}</div>
      <div class="li-info">
        <div class="li-name">${l.name}</div>
        <div class="li-desc">${l.desc}</div>
        <div class="li-row">
          <div class="li-price">â‚½${l.price.toLocaleString()}</div>
          <div class="status-chip ${l.status==='active'?'s-active':l.status==='sold'?'s-sold':'s-pending'}">
            ${l.status==='active'?'âœ“ ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾':l.status==='sold'?'âœ— ĞŸÑ€Ğ¾Ğ´Ğ°Ğ½Ğ¾':'â³ ĞĞ° Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞµ'}
          </div>
        </div>
      </div>
    </div>
  `).join('');
}

/* â”€â”€â”€ ADD LISTING MODAL â”€â”€â”€ */
const EMOJIS = ['ğŸ“±','ğŸ’»','ğŸ‘Ÿ','ğŸ®','ğŸ“¸','ğŸ§','ğŸ‘—','âŒš','ğŸ§´','ğŸ‹ï¸','ğŸ›‹ï¸','ğŸ¨','ğŸš—','ğŸ¸','ğŸ“š','ğŸ§¸','ğŸ€','ğŸ›’','ğŸ”§','ğŸ’¡'];

function buildEmojiGrid() {
  const g = document.getElementById('emojiGrid');
  g.innerHTML = EMOJIS.map((em,i) => `
    <div class="ej-opt ${i===0?'sel':''}" onclick="selectEmoji(this,'${em}')">${em}</div>
  `).join('');
}

function selectEmoji(el, em) {
  haptic('light');
  document.querySelectorAll('.ej-opt').forEach(o=>o.classList.remove('sel'));
  el.classList.add('sel');
  selectedEmoji = em;
}

function openAddModal() {
  haptic('light');
  document.getElementById('addModal').classList.add('open');
}
function closeAddModal(e) {
  if(e.target===document.getElementById('addModal'))
    document.getElementById('addModal').classList.remove('open');
}

function submitListing() {
  const name  = document.getElementById('newName').value.trim();
  const price = document.getElementById('newPrice').value.trim();
  const desc  = document.getElementById('newDesc').value.trim() || 'ĞĞµÑ‚ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ';
  if (!name || !price) {
    hapticNotify('error');
    toast('âš ï¸','Ğ—Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚Ğµ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸ Ñ†ĞµĞ½Ñƒ');
    return;
  }
  MY_LISTINGS.unshift({
    id: Date.now(), e: selectedEmoji,
    name, desc, price: parseInt(price), status: 'pending'
  });
  renderMyListings();
  document.getElementById('addModal').classList.remove('open');
  document.getElementById('newName').value  = '';
  document.getElementById('newDesc').value  = '';
  document.getElementById('newPrice').value = '';
  hapticNotify('success');
  toast('ğŸ‰','ĞĞ±ÑŠÑĞ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ Ğ½Ğ° Ğ¼Ğ¾Ğ´ĞµÑ€Ğ°Ñ†Ğ¸Ñ!');
}

/* â”€â”€â”€ ROLE SYSTEM â”€â”€â”€ */
function setRole(role, el) {
  haptic('medium');
  currentRole = role;
  document.querySelectorAll('#roleChips .chip').forEach(c=>c.classList.toggle('on', c.dataset.role===role));
  updateRoleUI();
  toast('ğŸ”„', `Ğ Ğ¾Ğ»ÑŒ: ${role==='owner'?'Ğ’Ğ»Ğ°Ğ´ĞµĞ»ĞµÑ†':role==='moderator'?'ĞœĞ¾Ğ´ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€':'ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ'}`);
}

function updateRoleUI() {
  const pill   = document.getElementById('rolePill');
  const pBadge = document.getElementById('pRoleTag');
  const pCrown = document.getElementById('pCrown');
  const adminNb = document.getElementById('nb-admin');

  const roleMap = {
    owner:     { pill:'rp-owner',  prt:'prt-owner',  label:'ğŸ‘‘ Ğ’Ğ»Ğ°Ğ´ĞµĞ»ĞµÑ†',   crown:'ğŸ‘‘',  showAdmin: true },
    moderator: { pill:'rp-mod',    prt:'prt-mod',     label:'ğŸ›¡ï¸ ĞœĞ¾Ğ´ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€', crown:'ğŸ›¡ï¸', showAdmin: true },
    user:      { pill:'rp-user',   prt:'prt-user',    label:'ğŸ‘¤ ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ',crown:'',  showAdmin: false },
  };
  const r = roleMap[currentRole];
  pill.className   = `role-pill ${r.pill}`;
  pill.textContent = r.label;
  pBadge.className = `p-role-tag ${r.prt}`;
  pBadge.textContent = r.label;
  pCrown.textContent = r.crown;
  pCrown.style.display = r.crown ? '' : 'none';
  adminNb.style.display = r.showAdmin ? '' : 'none';

  // Telegram Ñ‚ĞµĞ¼Ğ° ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ½Ğ°Ğ²Ğ±Ğ°Ñ€Ğ°
  tg?.MainButton?.setParams({ color: '#3b82f6', text_color: '#ffffff' });
}

function updateProfileUI() {
  const initials = userName.charAt(0).toUpperCase();
  if (!userPhoto) document.getElementById('pAvatar').textContent = initials;
}

/* â”€â”€â”€ ADMIN USERS â”€â”€â”€ */
function renderAdminUsers() {
  const c = document.getElementById('adminUserList');
  c.innerHTML = ADMIN_USERS.map(u => `
    <div class="user-row">
      <div class="ur-av" style="background:${u.color}22;color:${u.color}">${u.init}</div>
      <div>
        <div class="ur-name">${u.name}</div>
        <div class="ur-role" style="color:${u.role==='moderator'?'#8b5cf6':'var(--tg-hint)'}">
          ${u.role==='moderator'?'ğŸ›¡ï¸ ĞœĞ¾Ğ´ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€':'ğŸ‘¤ ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ'}
        </div>
        <div class="tg-username">${u.tg}</div>
      </div>
      <div class="ur-btns">
        ${currentRole==='owner'?`<button class="ur-btn urb-m" onclick="haptic('medium');toast('ğŸ›¡ï¸','Ğ Ğ¾Ğ»ÑŒ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ°')">Ğ Ğ¾Ğ»ÑŒ</button>`:''}
        <button class="ur-btn urb-w" onclick="haptic('medium');toast('âš ï¸','ĞŸÑ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾')">Warn</button>
        <button class="ur-btn urb-b" onclick="haptic('medium');toast('ğŸš«','ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½')">Ban</button>
      </div>
    </div>
  `).join('');
}

/* â”€â”€â”€ TOAST â”€â”€â”€ */
let toastTimer;
function toast(icon, text) {
  clearTimeout(toastTimer);
  document.getElementById('t-ico').textContent = icon;
  document.getElementById('t-txt').textContent = text;
  const t = document.getElementById('toast');
  t.classList.add('show');
  toastTimer = setTimeout(()=>t.classList.remove('show'), 2500);
}

/* â”€â”€â”€ Telegram BackButton handling â”€â”€â”€ */
tg?.BackButton?.onClick(() => {
  // Ğ—Ğ°ĞºÑ€Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¼Ğ¾Ğ´Ğ°Ğ»ĞºĞ¸ ĞµÑĞ»Ğ¸ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ñ‹
  if (document.getElementById('addModal').classList.contains('open')) {
    document.getElementById('addModal').classList.remove('open');
    return;
  }
  if (document.getElementById('pdModal').classList.contains('open')) {
    document.getElementById('pdModal').classList.remove('open');
    return;
  }
  tg.BackButton.hide();
  goPage('home');
});

/* â”€â”€â”€ GO! â”€â”€â”€ */
init();
</script>
</body>
</html>
